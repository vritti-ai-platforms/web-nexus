name: Deploy vritti-web-nexus to Production

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    name: Build Web Container
    uses: vritti-ai-platforms/infrastructure/.github/workflows/build-web.yml@main
    with:
      app_type: container
      app_name: vritti-web-nexus
      deploy_path: /
      node_version: '20'
      build_command: pnpm build
      output_dir: dist
      # ZERO ENVIRONMENT VARIABLES:
      # No production_domain needed - frontend uses window.location.origin
      # Build is environment-agnostic and works on any domain

  deploy:
    name: Deploy to Production
    needs: build
    uses: vritti-ai-platforms/infrastructure/.github/workflows/deploy-web-build.yml@main
    with:
      artifact_name: ${{ needs.build.outputs.artifact_name }}
      deploy_path: /opt/vritti/www
      backup_existing: true
      health_check_url: https://${{ vars.APP_DOMAIN }}
    secrets:
      SERVER_VM_HOST: ${{ secrets.SERVER_VM_HOST }}
      SERVER_VM_USER: ${{ secrets.SERVER_VM_USER }}
      SERVER_VM_SSH_KEY: ${{ secrets.SERVER_VM_SSH_KEY }}
